# Хостинг DBAlpha через ngrok

ngrok дає публічний HTTPS-URL до вашого локального сервера, щоб можна було відкрити сайт з інтернету (тестування, демо, доступ з телефону).

## Варіант 1: ngrok з командного рядка (рекомендовано)

### 1. Встановити ngrok

- Завантажте: https://ngrok.com/download  
- Або через winget: `winget install ngrok.ngrok`  
- Зареєструйтесь на https://dashboard.ngrok.com і скопіюйте **authtoken** з https://dashboard.ngrok.com/get-started/your-authtoken  
- В терміналі вставте **свій** токен (довгий рядок з dashboard; не пишіть буквально YOUR_TOKEN):  
  `npx ngrok config add-authtoken ВСТАВТЕ_СЮДИ_ВАШ_ТОКЕН`

### 2. Запустити проєкт

У **першому** терміналі:

```bash
cd c:\Users\Froze\OneDrive\Desktop\DBAlpha
npm run dev
```

Сервер має працювати на `http://localhost:3000`.

### 3. Запустити ngrok

У **другому** терміналі (з папки проєкту DBAlpha):

```bash
npx ngrok http 3000
```

Якщо встановлено глобальний ngrok CLI, можна просто: `ngrok http 3000`.

У виводі з’явиться публічне посилання, наприклад:

```
Forwarding   https://abc123.ngrok-free.app -> http://localhost:3000
```

**Важливо:** копіюйте **повне** посилання — воно завжди закінчується на **`.ngrok-free.app`** (не `.ngr`). Приклад: `https://xxxx.ngrok-free.app`

Відкрийте це **https**-посилання в браузері — сайт буде доступний з інтернету.

### 4. Якщо порт інший

Якщо в `.env` вказано інший `PORT` (наприклад 5000), використовуйте його:

```bash
ngrok http 5000
```

---

## Варіант 2: ngrok через npm-пакет (з коду)

У проєкті вже є залежність `ngrok`. Можна додати скрипт, який піднімає тунель після запуску сервера.

### Додати скрипт у package.json

```json
"scripts": {
  "tunnel": "node -e \"require('ngrok').connect(process.env.PORT||3000).then(u=>console.log('Public URL:',u))\""
}
```

Потім у **одному** терміналі спочатку запустіть сервер (`npm run dev`), у **іншому** — тунель:

```bash
npm run tunnel
```

Публічний URL з’явиться в консолі.

---

## Важливо

1. **Сервер має бути запущений** — ngrok лише пробрасывает трафік на ваш `localhost:3000`.
2. **База даних** — якщо використовуєте Neon (як у NEON_SETUP.md), вона вже в інтернеті, тож все працюватиме через ngrok.
3. **Безкоштовний ngrok** — URL змінюється при кожному запуску. Платний план дає фіксований домен.
4. **Безпека** — не використовуйте для продакшену з секретами; це зручно для тесту та демо.

---

## Швидкий чеклист

| Крок | Дія |
|------|-----|
| 1 | Встановити ngrok, додати authtoken |
| 2 | `npm run dev` (термінал 1) |
| 3 | `ngrok http 3000` (термінал 2) |
| 4 | Відкрити https-URL з виводу ngrok у браузері |

Готово.

---

## Помилка «authtoken does not look like a proper ngrok authtoken»

Це означає, що в конфіг потрапив placeholder (наприклад `YOUR_AUTHTOKEN`) замість справжнього токена.

**Що зробити:**

1. Відкрийте https://dashboard.ngrok.com/get-started/your-authtoken (зайдіть у свій акаунт ngrok).
2. Скопіюйте **Authtoken** — це один довгий рядок (на кшталт `2abc...xyz`).
3. В терміналі з папки проєкту виконайте (підставте свій токен замість `ВАШ_ТОКЕН`):
   ```bash
   npx ngrok config add-authtoken ВАШ_ТОКЕН
   ```
4. Знову запустіть тунель: `npx ngrok http 3000`.

---

## Після запуску ngrok «не вдається знайти сайт»

Перевірте по черзі:

### 1. Сервер має бути запущений
ngrok лише перенаправляє трафік на ваш комп’ютер. Якщо сервер не працює — буде помилка з’єднання.

- У **першому** терміналі обов’язково запустіть: `npm run dev`
- Переконайтесь, що в консолі є рядок на кшталт: `Server running at: http://localhost:3000`
- Тільки після цього у **другому** терміналі запускайте: `npx ngrok http 3000`

### 2. Один і той самий порт
Порт у ngrok має збігатися з портом сервера. Якщо в `.env` вказано `PORT=3000`, команда така: `npx ngrok http 3000`. Якщо, наприклад, `PORT=5000` — тоді `npx ngrok http 5000`.

### 3. Сторінка «Visit Site» (безкоштовний ngrok)
У безкоштовній версії ngrok при першому відкритті посилання може з’явитися **перехідна сторінка** з кнопкою **«Visit Site»**. Це не помилка — натисніть **Visit Site**, після цього відкриється ваш сайт.

### 4. Перевірка, що тунель працює
Відкрийте в браузері (підставте свій URL з виводу ngrok):

- Головна: `https://ВАШ-ID.ngrok-free.app/`
- Перевірка сервера: `https://ВАШ-ID.ngrok-free.app/api/health`

Якщо `/api/health` повертає JSON з `"status":"healthy"` — сервер доступний через ngrok, і проблема може бути в кеші браузера або в тому, що потрібно натиснути «Visit Site» на перехідній сторінці.

### 5. Помилка «Не вдається з'єднатися з сервером ... .ngr»
Браузер намагається відкрити **обрізану** адресу. Домен має закінчуватися на **`.ngrok-free.app`**, а не на `.ngr`.

- Правильно: `https://craniometrical-mariyah-uninstinctive.ngrok-free.app`
- Неправильно: `...uninstinctive.ngr` (без `ok-free.app`)

Скопіюйте URL з терміналу ngrok **цілком** (включно з `https://` і `.ngrok-free.app`) і вставте в адресний рядок. Не дописуйте вручну і не обрізайте кінець.
